{{/* ----------------------------------------------------------- */}}
{{/* 1) Extraemos todos los src="…" de las imágenes definidas en .Content */}}
{{ $srcAttrs := findRE `src="[^\"]+"` .Content }}

<div
  x-data="{
    isOpen: false,
    currentIndex: 0,
    images: [
      {{- /* Construimos el array de URLs para Alpine */ -}}
      {{- range $i, $attr := $srcAttrs -}}
        '{{ replaceRE `src=\\"([^\\\"]+)\\"` `$1` $attr }}'{{ if lt (add $i 1) (len $srcAttrs) }},{{ end }}
      {{- end -}}
    ]
  }"
  class="mx-auto max-w-6xl px-4 py-8"
>
  <!-- 2) Grid de miniaturas -->
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
    {{- range $i, $attr := $srcAttrs -}}
      {{ $url := replaceRE `src=\\"([^\\\"]+)\\"` `$1` $attr }}
      <button
        @click="currentIndex = {{ $i }}; isOpen = true"
        class="overflow-hidden rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
      >
        <div class="aspect-w-1 aspect-h-1">
          <img
            src="{{ $url }}"
            alt="Imagen {{ add $i 1 }}"
            class="object-cover w-full h-full hover:scale-105 transition-transform duration-200"
          />
        </div>
      </button>
    {{- end -}}
  </div>

  <!-- 3) Modal + Carrusel -->
  <template x-if="isOpen">
    <div
      class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 px-4 py-6"
      @keydown.escape.window="isOpen = false"
    >
      <!-- Botón Cerrar -->
      <button
        @click="isOpen = false"
        class="absolute top-4 right-4 text-white hover:text-gray-300"
        aria-label="Cerrar galería"
      >
        <!-- Icono “X” -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none"
             viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <div class="relative w-full max-w-3xl">
        <!-- Imagen ampliada -->
        <div class="w-full">
          <img
            :src="images[currentIndex]"
            class="object-contain w-full max-h-[80vh]"
            alt="Imagen ampliada"
          />
        </div>

        <!-- Botón “Prev” -->
        <div class="absolute inset-y-0 left-0 flex items-center">
          <button
            @click="currentIndex = (currentIndex === 0) ? images.length - 1 : currentIndex - 1"
            class="p-3 bg-white bg-opacity-20 rounded-full text-white hover:bg-opacity-40 focus:outline-none"
            aria-label="Anterior"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 19l-7-7 7-7" />
            </svg>
          </button>
        </div>

        <!-- Botón “Next” -->
        <div class="absolute inset-y-0 right-0 flex items-center">
          <button
            @click="currentIndex = (currentIndex === images.length - 1) ? 0 : currentIndex + 1"
            class="p-3 bg-white bg-opacity-20 rounded-full text-white hover:bg-opacity-40 focus:outline-none"
            aria-label="Siguiente"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>

        <!-- Indicadores (puntos) opcionales -->
        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
          <template x-for="(img, idx) in images" :key="idx">
            <button
              @click="currentIndex = idx"
              :class="{
                'bg-white': idx === currentIndex,
                'bg-white bg-opacity-50 hover:bg-opacity-75': idx !== currentIndex
              }"
              class="w-3 h-3 rounded-full focus:outline-none"
            ></button>
          </template>
        </div>
      </div>
    </div>
  </template>
</div>
{{/* ----------------------------------------------------------- */}}